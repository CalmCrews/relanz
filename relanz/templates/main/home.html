{% extends 'mobileBase.html' %}
{% load static %}
{% block mobile_title %}
  Home | Start!
{% endblock mobile_title %}

{% block mobile_extrahead %}
  <link rel="stylesheet" type="text/css" href="{% static "css/main/home.css"%}">
{% endblock mobile_extrahead %}

{% block mobile_content%}
  {% if not user.nickname %}
    <div id="profile-unset">
      <p class="signin-complete">회원가입이 완료되었습니다!</p>
      <div class="welcome-box">
        <img src="{% static "images/welcome-box.png" %}" alt="welcome-img">
      </div>
      <p class="wel-message">이제 릴렌즈와<br>스트레스 해소법을 찾아보아요!</p>
      <a href="{% url 'user:content' %}" class="user-button" id="profile_setting">프로필 설정하기</a>
    </div>
  {% else %}
    <div id="profile-set">
      <div class="page-wrapper">
        <div id="today_date"></div>
        <div class="profile-section">

          <div class="profile-wrapper">
            <div class="profile-circle">
              <div class="back-hair"></div>
              <div class="face"></div>
              <div class="front-hair"></div>
              <div class="eyebrows"></div>
              <div class="eyes"></div>
              <div class="nose"></div>
              <div class="mouth"></div>
              <div class="makeup"></div>
              <div class="clothes"></div>
              <div class="acc"></div>
            </div>
          </div>
          <div class="bubble">
            <div class="triangle"><img src="{%static 'icons/triangleforbubble.png'%}" alt=""></div>
            <div class="circle"><p>{{ user.nickname }}님에게 도착한 오늘의 한마디 &#128172;<p></div>
            <div class="hidden-message"><p>오늘도 화이팅!<p></div>
          </div>
        </div>
        <div class="name">
          <span>{{ user.nickname }}</span>
          님
        </div>
        <div class="score-section">
          <div class="score-icon">
            <img src="{% static "icons/star30.png"%}" alt="star">
            <span>Lv.
              <span id="user_level">1</span>
            </span>
          </div>
          <span>score</span>
          <div class="score-graph">
            <div class="goal-score-bar"></div>
            <div class="current-score-bar">
              <span></span>
            </div>
          </div>
        </div>

        <div id="top-page">
          <div class="top-page-content">
            <div class="header-message">
              <img src="{% static "icons/dot.png" %}" alt="">
              <span>{{ user.nickname }}님께 추천하는 관리 활동입니다</br>마음에 드는 릴렌지를 시도해보아요!</span>
            </div>
            <div class="relenge-section">
              <ul class="tag-list">
                {% comment %} 임시 {% endcomment %}
                <li>전체</li>
                <li>야외</li>
                <li>실내</li>
                <li>동적인</li>
                <li>정적인</li>
                <li>혼자서</li>
                {% comment %} {% for item in tag_list %}
                  <li>{{item}}</li>
                {% endfor %} {% endcomment %}
                
              </ul>
              <div class="relenge-list-container">
                <ul class="relenge-list">
                  {% comment %} 임시 {% endcomment %}
                  <li>
                    <div class="relenge-card">
                      <div class="image-section">
                        <img src="" alt="">
                      </div>
                      <div class="info-section">
                        <div class="sticker">공식 릴렌지 활동</div>
                        <h2>전체</h2>
                        <img src="{% static "icons/ppl.png" %}" alt="icon"/>
                        <span>n명이 참여 중인 릴렌지</span>
                        <a href="">참여하기</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="relenge-card">
                      <div class="image-section">
                        <img src="" alt="">
                      </div>
                      <div class="info-section">
                        <div class="sticker">공식 릴렌지 활동</div>
                        <h2>야외</h2>
                        <img src="{% static "icons/ppl.png" %}" alt="icon"/>
                        <span>n명이 참여 중인 릴렌지</span>
                        <a href="">참여하기</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="relenge-card">
                      <div class="image-section">
                        <img src="" alt="">
                      </div>
                      <div class="info-section">
                        <div class="sticker">공식 릴렌지 활동</div>
                        <h2>실내</h2>
                        <img src="{% static "icons/ppl.png" %}" alt="icon"/>
                        <span>n명이 참여 중인 릴렌지</span>
                        <a href="">참여하기</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="relenge-card">
                      <div class="image-section">
                        <img src="" alt="">
                      </div>
                      <div class="info-section">
                        <div class="sticker">공식 릴렌지 활동</div>
                        <h2>동적인</h2>
                        <img src="{% static "icons/ppl.png" %}" alt="icon"/>
                        <span>n명이 참여 중인 릴렌지</span>
                        <a href="">참여하기</a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="relenge-card">
                      <div class="image-section">
                        <img src="" alt="">
                      </div>
                      <div class="info-section">
                        <div class="sticker">공식 릴렌지 활동</div>
                        <h2>정적인</h2>
                        <img src="{% static "icons/ppl.png" %}" alt="icon"/>
                        <span>n명이 참여 중인 릴렌지</span>
                        <a href="">참여하기</a>
                      </div>
                    </div>
                  </li>
                </ul>
                <div class="carousel-dots">
                  <span class="dot active"></span>
                  <span class="dot"></span>
                  <span class="dot"></span>
                  <span class="dot"></span>
                  <span class="dot"></span>
                </div>
                <div class="carousel-arrows">
                  <span class="arrow arrow-left"><img src="{% static "icons/leftarrow.png" %}" alt="left-arrow"></span>
                  <span class="arrow arrow-right"><img src="{% static "icons/rightarrow.png" %}" alt="right-arrow"></span>
                </div>
              </div>
            </div>
            <div class="report-section">
              <div class="report-header">
                <div class="report-title" style="background-image: url('{% static "icons/report-title.png" %}')">
                  {{user.nickname}}님의<br>스트레스 관리 리포트
                </div>
                <div class="weekly-monthly">
                  <div class="weekly-option option-active">주간</div>
                  <div class="monthly-option">월간</div>
                  <div class="slide-button"></div>
                </div>
              </div>
              <div class="report-summary">
                <div class="summary-block">
                  <span>&#128079;</span>
                  <p>{{user.nickname}}님이 참여하신 릴렌지를 바탕으로 정리한<br>{{user.nickname}}님만의 건강한 스트레스 해소 활동입니다</p>
                </div>
                <div class="summary-detail-1">
                  스트레스 취약성 테스트 문항 {{ user.survey_result_count }}개를 선택하신<br>
                  {{ user.nickname }}님!<br>
                  {{ user.nickname }}님은 스트레스에 {{ user_survey_result }} 편 입니다
                  <p>전체 {{ all_percentages }}</p>
                  <p>성별 {{ sex_percentages }}</p>
                  <p>나이 {{ age_percentages }}</p>
                  <p>
                    {% if user.sex == 'female'%}
                    {{ age_group_start }}대 여성이 가진 스트레스 취약성에 비해 {{avg_result}}인 편이에요 
                    {% elif user.sex == 'male'%}
                    {{ age_group_start }}대 남성이 가진 스트레스 취약성에 비해 평균적인 편이에요
                    {% endif %}
                  </p>
                </div>
                <div class="summary-detail-2"></div>
              </div>
              <div class="relanz-magazine">
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  {% endif %}
{% endblock %}


{% block mobile-scripts %}
  <script>
    function renderProfileCombination(combinationData) {
      const backHairElement = document.querySelector(".back-hair");
      const frontHairElement = document.querySelector(".front-hair");
      const eyebrowsElement = document.querySelector(".eyebrows");
      const eyesElement = document.querySelector(".eyes");
      const noseElement = document.querySelector(".nose");
      const mouthElement = document.querySelector(".mouth");
      const cheekElement = document.querySelector(".makeup");
      const faceElement = document.querySelector(".face");
      const clothesElement = document.querySelector(".clothes");
      const accElement = document.querySelector(".acc");
    
      // 각 조합 요소의 숫자에 해당하는 이미지 경로 설정
      frontHairElement.style.backgroundImage = `url("{% static 'character/fronthair/fronthair' %}${combinationData[0]}.png")`;
      if (combinationData[1] > 0)
        backHairElement.style.backgroundImage = `url("{% static 'character/backhair/backhair' %}${combinationData[1]}.png")`;
      eyebrowsElement.style.backgroundImage = `url("{% static 'character/brows/brows' %}${combinationData[2]}.png")`;
      eyesElement.style.backgroundImage = `url("{% static 'character/eyes/eyes' %}${combinationData[3]}.png")`;
      noseElement.style.backgroundImage = `url("{% static 'character/nose/nose' %}${combinationData[4]}.png")`;
      mouthElement.style.backgroundImage = `url("{% static 'character/mouth/mouth' %}${combinationData[5]}.png")`;
      if (combinationData[6] > 0)
        cheekElement.style.backgroundImage = `url("{% static 'character/makeup/makeup' %}${combinationData[6]}.png")`;
      faceElement.style.backgroundImage = `url("{% static 'character/face.png' %}")`;
      clothesElement.style.backgroundImage = `url("{% static 'character/clothes/clothes' %}${combinationData[7]}.png")`;
      if (combinationData[8] > 0)
        accElement.style.backgroundImage = `url("{% static 'character/acc/acc' %}${combinationData[8]}.png")`;

    }
    //오늘 날짜 불러오기
    const dateElement = document.getElementById('today_date');
    const options = { year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'long' };
    const today = new Date();

    const formattedDate = today.toLocaleDateString('ko-KR', options);
    dateElement.innerText = formattedDate;

    //score graph
    //var userScore = {{ user.score }};
    var userScore = 999;
    var goalScore;
    var userLevel = "1";

    if (userScore <= 1000) {
      goalScore = 1000;
      userLevel = "1";
    } else if (userScore <= 5000) {
      goalScore = 5000;
      userLevel = "2";
    } else if (userScore <= 10000) {
      goalScore = 10000;
      userLevel = "3";
    } else if (userScore <= 20000) {
      goalScore = 20000;
      userLevel = "4";
    } else {
      goalScore = 50000;
    }

    var userLevelSpan = document.getElementById("user_level");
    var userScoreSpan = document.querySelector(".current-score-bar > span")
    var currentScoreWidth = (userScore / goalScore) * 150 + 5;
    var currentScoreBar = document.querySelector(".current-score-bar");

    //user level설정
    userLevelSpan.textContent = userLevel;
    userScoreSpan.textContent = userScore;
    // 초기 상태에서 너비를 0으로 설정
    currentScoreBar.style.width = "0";

    // 지정된 시간 간격마다 너비를 증가시키는 애니메이션 함수
    function animateScoreBar() {
      var width = 0;
      var interval = setInterval(function() {
        width += currentScoreWidth / 10; 
        currentScoreBar.style.width = width + "px";
        if (width >= currentScoreWidth) {
          clearInterval(interval);
        }
      }, 3); 
    }

    // 페이지가 로드될 때 애니메이션 실행
    window.addEventListener("load", animateScoreBar);

    
    // 조합 데이터를 적용하여 프로필 렌더링
    //console.log({{user.avatar}})
    renderProfileCombination("{{user.avatar}}");
    
    //오늘의 메세지 전환 효과
    const bubble = document.querySelector('.bubble');
    const bubbleMessage = document.querySelector('.bubble > .circle > p');
    const hiddenMessage = document.querySelector('.hidden-message');
    const triangle = document.querySelector('.bubble .triangle');
    const circle = document.querySelector('.bubble .circle');
    
    bubble.addEventListener('click', function() {

      const isBubbleClicked = bubble.classList.contains('clicked');
      if (isBubbleClicked) {
        bubble.classList.remove('clicked');
        bubble.classList.add('unclicked');
        bubbleMessage.style.display = 'block';
        hiddenMessage.style.display = 'none';
      }
      else {
        bubble.classList.add('clicked');
        bubble.classList.remove('unclicked');
        bubbleMessage.style.display = 'none';
        hiddenMessage.style.display = 'flex';
      }

    });


    //릴렌지 카드 섹션
    const carouselContainer = document.querySelector('.relenge-list');
    const dots = document.querySelectorAll('.dot');
    const items = document.querySelectorAll('.relenge-card');
    const prev = document.querySelector('.arrow-left');
    const next = document.querySelector('.arrow-right');
    let active = 0;


    // 이전 카드 보기

    function loadShow(){
      let stt = 0;
      items[active].style.transform = `none`;
      items[active].style.zIndex = 1;
      items[active].style.filter = 'none';
      items[active].style.opacity = 1;
      for(var i = active + 1; i < items.length; i++){
        stt++;
        items[i].style.transform = `translateX(${120*stt}px) scale(${1 - 0.25*stt}) perspective(16px) rotateY(-0.5deg)`;
        items[i].style.zIndex = -stt;
        items[i].style.filter = 'blur(3px)';
        items[i].style.opacity = stt > 2 ? 0 : 0.6;
      }
      stt = 0;
      for(var i = active - 1; i >= 0; i--){
        stt++;
        items[i].style.transform = `translateX(${-120*stt}px) scale(${1 - 0.25*stt}) perspective(16px) rotateY(0.5deg)`;
        items[i].style.zIndex = -stt;
        items[i].style.filter = 'blur(3px)';
        items[i].style.opacity = stt > 2 ? 0 : 0.6;
      }
      dots.forEach(dot => {
        dot.classList.remove('active');
      });

      dots[active].classList.add('active');
    }
    loadShow();
    // 카드 및 점 업데이트

      

    // 점 클릭 이벤트
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        active = index;
        loadShow();
      });
    });

    next.onclick = function(){
      active = active + 1 < items.length ? active + 1 : active;
      loadShow();
    }
    prev.onclick = function(){
      active = active - 1 >= 0 ? active - 1 : active;
      loadShow();
    }
   

    //주간 - 월간 슬라이딩 버튼
    var weeklyOption = document.querySelector('.weekly-option');
    var monthlyOption = document.querySelector('.monthly-option');
    var slideButton = document.querySelector('.slide-button');

    function activateOption(option) {
      option.classList.add('option-active');
      var siblingOption = option === weeklyOption ? monthlyOption : weeklyOption;
      siblingOption.classList.remove('option-active');
      slideButton.style.left = option.offsetLeft + 'px';
    }

    weeklyOption.addEventListener('click', function() {
      activateOption(weeklyOption);
    });

    monthlyOption.addEventListener('click', function() {
      activateOption(monthlyOption);
    });
  </script>


{% endblock %}


<!-- {% for challenge, participant in combined_data %}
<p>Challenge: {{ challenge.title }}</p>
{% if challenge.image %}
<img src="{% static challenge.image %}" alt="이미지">
{% endif %}
<p>Participant: {{ participant }}</p>
{% endfor %}
코드를 실행해 보면 알 수 있습니다! -->


